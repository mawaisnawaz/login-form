<section class="col-md-10 col-sm-10 col-xs-12 main-section">
    <h2 class="main-heading">Daily  Viewership  Report  and  Timelines</h2>

    {{!-- <div class="col-md-3 col-sm-3">
        <div class="gradientBackground"></div>
    </div> --}}
    <div class="col-md-12 col-sm-12">
        <div class="gradientBackground">
            <div id="container" style="min-width: 310px; height: 200px; margin: 0 auto"></div> 
        </div>
    </div>
    {{!-- <div class="col-md-3 col-sm-3">
        <div class="gradientBackground"></div>
    </div> --}}
    <div class="col-md-12 col-sm-12">
        <table class="report-detail display table" id="dataTable">
            <thead>
                <th width="20%">Rank</th>
                <th width="20%">Content ID</th>
                <th width="30%">Content Name</th>
                <th width="20%">Total Access Hours</th>
            </thead>
            <tbody>
                {{#each data}}
                <tr>
                    <td>{{rank}}</td>
                    <td>{{contentid}}</td>
                    <td>{{contentname}}</td>
                    <td>{{fixedValue total_length}}</td>
                </tr>
                {{/each}}
            </tbody>
        </table>
    </div>
</section>  
<div id="mySidenav" class="sidenav">
    <h3>Program viewership report</h3>
    <form action="" class="sky-form" id="filter">
        
        <fieldset>                  
            <section>
                <label class="label">Date</label>
                <label class="input">
                    <div class="input-group date-picker input-daterange" id="datepicker" data-date-format="dd-mm-yyyy">
                        <input type="text" name="s_date" class="form-control datepicker" id="reportDate" onkeydown="return false">
                        {{!-- <span class="input-group-addon"> <i class="fa fa-minus"></i> </span>
                        <input type="text" class="form-control datepicker" id="reportToDate" onkeydown="return false">  --}}
                    </div>
                </label>
            </section>
            
            <section>
                <label class="label">Time Band</label>
                <label class="input">
                    <select class="selectpicker" name="timeband" data-live-search="true" multiple="">
                        <option value="1">00:00-01:00</option>
                        <option value="2">01:00-02:00</option>
                        <option value="3">02:00-03:00</option>
                        <option value="4">03:00-04:00</option>
                        <option value="5">04:00-05:00</option>
                        <option value="6">05:00-06:00</option>
                        <option value="7">06:00-07:00</option>
                        <option value="8">07:00-08:00</option>
                    </select>
                </label>
            </section>


            {{!-- <section>
                <label class="label">Channel</label>
                <label class="input">
                    <select class="selectpicker" data-live-search="true" multiple="">
                    </select>
                </label>
            </section> --}}

            <section>
                <label class="label">Devices</label>
                <label class="input">
                    <select id="selectDevice" name="devicetype" class="selectpicker" data-live-search="true" multiple="">
                        {{#each devices}}
                        <option value='{{this}}'>{{this}}</option>
                        {{/each}}
                    </select>
                </label>
            </section>
            {{!-- <section>
                <label class="label">Geo Location</label>
                <div class="row">
                    <div class="col col-4">
                        <label class="radio"><input type="radio" name="geolocation" checked><i></i>all</label>
                    </div>
                </div>
            </section> --}}

            <section>
                <label class="label">Service Type</label>
                <div class="row service_type">
                   <div class="col col-6">
                        <label class="radio"><input type="radio" name="servicetype" value='1'><i></i>Live TV</label>
                    </div>
                    <div class="col col-6">
                        <label class="radio"><input type="radio" name="servicetype" value='2'><i></i>CUTV</label>
                    </div>
                </div>
            </section>

            <section>
                <label class="label">UI Group ID</label>
                <label class="input">
                    <select class="selectpicker"  name="uigroupid" data-live-search="true" multiple="">
                        {{#each groupIds}}
                        <option value='{{this}}'>{{this}}</option>
                        {{/each}}
                    </select>
                </label>
            </section>


            <section>
                <label class="label">Platform</label>
                <div class="row">
                    <div class="col col-4">
                        <label class="radio"><input type="radio" checked><i></i>all</label>
                    </div>
                    <div class="col col-4">
                        <label class="radio"><input type="radio" ><i></i>iptv</label>
                    </div>
                    <div class="col col-4">
                        <label class="radio"><input type="radio" ><i></i>ott</label>
                    </div>
                </div>
            </section>

            <section>
                <label class="label">Genre</label>
                <label class="input">
                    <select class="selectpicker" name="genrename" data-live-search="true" multiple="">
                        {{#each genre}}
                        <option value='{{this}}'>{{this}}</option>
                        {{/each}}
                    </select>
                </label>
            </section>

            <section>
                <label class="label">Age</label>
                <label class="input">
                    <select class="selectpicker" name="age" data-live-search="true" multiple="">
                        <option value='[4, 5, 6, 7, 8, 9]'>4-9</option>
                        <option>10-14</option>
                        <option>15-24</option>
                        <option>25-34</option>
                        <option>35-44</option>
                        <option>45-54</option>
                        <option>55-64</option>
                        <option>Above 65</option>
                    </select>
                </label>
            </section>
            <section>
                <label class="label">Nationality</label>
                <label class="input">
                    <select class="selectpicker" name="nationality" data-live-search="true" multiple="">
                        {{#each nationality}}
                        <option value='{{this}}'>{{this}}</option>
                        {{/each}}
                    </select>
                </label>
            </section>
            <section>
                <label class="label">Region</label>
                <label class="input">
                    <select class="selectpicker" name="region" data-live-search="true" multiple="">
                        {{#each region}}
                        <option value="{{name}}">{{city_name}}</option>
                        {{/each}}
                    </select>
                </label>
            </section>
            <section>
                <label class="label">Gender</label>
                <div class="row">
                    <div class="col col-4">
                        <label class="radio"><input type="radio" name="gender" value="male"><i></i>male</label>
                    </div>
                    <div class="col col-4">
                        <label class="radio"><input type="radio" name="gender" value="female"><i></i>female</label>
                    </div>
                    <div class="col col-4">
                        <label class="radio"><input type="radio" name="gender" value="unknown"><i></i>unknown</label>
                    </div>
                </div>
            </section>

            <section>
                <button type="button" id="submitFilter" class="filter-submit blue-button">submit</button>
            </section>
        </fieldset>
    </form>
</div>

{{#section 'jquery'}}
        
        
<!--dynamic table-->
<script src="/js/advanced-datatable/js/jquery.dataTables.js" type="text/javascript" language="javascript" ></script>
<script src="/js/data-tables/DT_bootstrap.js" type="text/javascript" ></script>
<script src="/js/dynamic_table_init.js"></script>
<script type="text/javascript">
    var selectedDate;
    var timeband = [];
    var channels = [];
    var devices;

    // Date
    $(document).ready(function() {
        $('.datepicker').datepicker().on('change', function () {
            if($('#reportDate').val()){
                selectedDate = $('#reportDate').val();
                console.log(selectedDate);
            }
        });
    });

    $("#submitFilter").click(function(){
        var filterData = $('#filter').serializeArray();
        console.log(filterData);

        var params = []
        for (var i=0; i<filterData.length; i++){
            if (filterData[i].value){
                if(filterData[i].name=='s_date' || filterData[i].name=='servicetype' ){
                    params[filterData[i].name] = filterData[i].value;
                    continue;
                }
                if(!params[filterData[i].name]){
                     params[filterData[i].name] = [];
                }
                params[filterData[i].name].push(filterData[i].value);
            }
        }

        console.log(params);

        var param= {'params' : 'this is my param'};
        $.get('/filter', param, function(data) {
            console.log(data);
        });
    });
  
</script>

<script type="text/javascript">
    var trendData = '{{{ stringify trendData }}}';
    trendData = JSON.parse(trendData);

    var timeband = []
    var accessHrsBar = []
    var accessHrsLine = []

    for(var i=0; i<trendData.length; i++){
        timeband.push(trendData[i].timeband);
        accessHrsBar.push(trendData[i].total_leng);
        accessHrsLine.push(trendData[i].total_leng1);
    }

    loadTrend(timeband, accessHrsBar, accessHrsLine);

    function loadTrend(timeband, accessHrsBar, accessHrsLine){
        Highcharts.chart('container', {
            chart: {
                zoomType: 'xy',
                backgroundColor:'transparent'
            },
            title: {
                text: '',
            },
            credits:{
                enabled:false
            }, exporting:{
                enabled:false
            },
            xAxis: [{
                categories: timeband,
                minorGridLineWidth: 0,
            }],
            yAxis: [{ // Primary yAxis
                minorGridLineWidth: 0,
                gridLineWidth: 0,
                labels: {
                    enabled: false
                },
                title: {
                    text: ''
                }
            }],
            tooltip: {
                shared: true
            },
            legend: {
                enabled: false
            },
            plotOptions: {
                series: {
                    stacking: 'normal',
                    borderWidth: 0
                }
            },
            series: [{
                name: 'Access Hours',
                type: 'column',
                data: accessHrsBar, //[49.9, 71.5, 106.4, 129.2, 144.0, 176.0, 135.6, 148.5, 216.4, 194.1, 95.6, 54.4],
                color: '#3E75C8',
                tooltip: {
                    valueSuffix: ' hours'
                }

            }, {
                name: 'Access Hours',
                type: 'spline',
                data: accessHrsLine, //[49.9, 71.5, 106.4, 129.2, 144.0, 176.0, 135.6, 148.5, 216.4, 194.1, 95.6, 54.4],
                color: '#FFB88C',
                tooltip: {
                    valueSuffix: ' hours'
                }
            }]
        });
    }
</script>

<script type="text/javascript">
    function loadTable(data){
        var content = ''

        //content += '<table class="report-detail">'
        content += '    <thead>'
        content += '        <th width="20%">Rank</th>'
        content += '        <th width="20%">Content ID</th>'
        content += '        <th width="30%">Content Name</th>'
        content += '        <th width="20%">Total Access Hours</th>'
        content += '    </thead>'
        content += '    <tbody>'

            for (var i =0; i<data.length; i++){
                content += '<tr>'
                content += '    <td>'+data[i].rank+'</td>'
                content += '    <td>'+data[i].contentid+'</td>'
                content += '    <td>'+data[i].contentname+'</td>'
                content += '    <td>'+data[i].total_length+'</td>'
                content += '</tr>'
            }
                
        content += '    </tbody>'
        //content += '</table>'
        
        $('#dataTable').empty();
        $('#dataTable').append(content);
        $('#dataTable').dataTable({
            bDestroy: true,
            "iDisplayLength": 10,
            "aaSorting": [[ 0, "asc" ]],
            "lengthMenu": [ 10, 25, 50, 75, 100 ],
            "sSearch": "Filter: ",
        });
    }
</script>   

{{/section}}